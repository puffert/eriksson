---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const sortedPosts = allPosts.sort((a, b) => 
  b.data.pubDate.getTime() - a.data.pubDate.getTime()
);

const baseUrl = import.meta.env.BASE_URL.endsWith('/') 
  ? import.meta.env.BASE_URL 
  : `${import.meta.env.BASE_URL}/`;
---

<BaseLayout title="Blog Posts">
    <section class="blog-listing">
        <h1 class="section-title">ALL POSTS</h1>
        
        <div class="posts-grid">
            {sortedPosts.map((post) => (
                <article class="post-card">
                    <div class="post-header">
                        <span class="post-date">
                            {new Intl.DateTimeFormat('en-US', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit'
                            }).format(post.data.pubDate)}
                        </span>
                        <span class="post-category pixel-icon">
                            {post.data.icon || ''} {post.data.category.toUpperCase()}
                        </span>
                    </div>
                    <h2 class="post-title">
                        <a href={`${baseUrl}blog/${post.slug}`} style="color: inherit; text-decoration: none;">
                            {post.data.title}
                        </a>
                    </h2>
                    <p class="post-excerpt">{post.data.description}</p>
                    <a href={`${baseUrl}blog/${post.slug}`} class="post-link">READ MORE â†’</a>
                </article>
            ))}
        </div>

        {sortedPosts.length === 0 && (
            <div style="text-align: center; padding: 60px 20px;">
                <p style="color: var(--text-muted); font-size: 1.2rem;">
                    No posts yet. Check back soon!
                </p>
            </div>
        )}
    </section>
</BaseLayout>
