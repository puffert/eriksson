---
import BaseLayout from '../layouts/BaseLayout.astro';
import { challengesWithImages } from '../data/challenges';

const baseUrl = import.meta.env.BASE_URL.endsWith('/') 
  ? import.meta.env.BASE_URL 
  : `${import.meta.env.BASE_URL}/`;

// Group challenges by difficulty
const challengesByDifficulty = challengesWithImages.reduce((acc, challenge) => {
    const difficulty = challenge.difficulty;
    if (!acc[difficulty]) {
        acc[difficulty] = [];
    }
    acc[difficulty].push(challenge);
    return acc;
}, {} as Record<string, typeof challengesWithImages>);

// Difficulty order for display
const difficultyOrder = ['Easy', 'Easy-Medium', 'Medium', 'Medium-Hard', 'Hard', 'Very Hard', 'Varied'];

// Get difficulty emoji
function getDifficultyEmoji(difficulty: string): string {
    const emojiMap: Record<string, string> = {
        'Easy': 'ðŸŸ¢',
        'Easy-Medium': 'ðŸŸ¡',
        'Medium': 'ðŸŸ¡',
        'Medium-Hard': 'ðŸŸ ',
        'Hard': 'ðŸ”´',
        'Very Hard': 'ðŸŸ£',
        'Varied': 'âšª',
    };
    return emojiMap[difficulty] || 'âšª';
}

const totalChallenges = challengesWithImages.length;
---

<BaseLayout title="Labs">
    <section class="hero-section">
        <div class="hero-content">
            <h2 class="hero-title">
                <span class="glitch" data-text="SECURITY LABS">SECURITY LABS</span>
            </h2>
            <p class="hero-subtitle">Interactive â€¢ Hands-On â€¢ Real Exploits</p>
            <div class="terminal-window">
                <div class="terminal-header">
                    <span class="terminal-button"></span>
                    <span class="terminal-title">LAB_ENVIRONMENT</span>
                </div>
                <div class="terminal-body">
                    <div class="terminal-line">
                        <span class="prompt">></span>
                        <span class="command">loading_virtual_environments</span>
                    </div>
                    <div class="terminal-line">
                        <span class="output">[OK] Sandbox initialized</span>
                    </div>
                    <div class="terminal-line">
                        <span class="output">[OK] Attack vectors loaded</span>
                    </div>
                    <div class="terminal-line">
                        <span class="output">[OK] Target models deployed</span>
                    </div>
                    <div class="terminal-line">
                        <span class="output blinking-cursor">[READY] Lab environment active</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="posts-section" style="margin-bottom: 4rem;">
        <h2 class="section-title">COMING SOON</h2>
        <div style="text-align: center; padding: 3rem 2rem; background: rgba(0, 212, 255, 0.05); border: 2px solid rgba(0, 212, 255, 0.3); border-radius: 12px; margin-bottom: 3rem;">
            <div style="font-size: 1.5rem; color: #00d4ff; margin-bottom: 1.5rem; font-weight: bold;">
                ðŸš€ LAB IN BETA
            </div>
            <p style="color: var(--text-color); font-size: 1.1rem; line-height: 1.8; max-width: 800px; margin: 0 auto;">
                Get ready to dive into hands-on AI security challenges. Our interactive lab environment 
                will feature {totalChallenges}+ real-world scenarios covering prompt injection, 
                supply chain attacks, model security, and more.
            </p>
        </div>
    </section>

    <section class="posts-section">
        <h2 class="section-title">ACTIVE CHALLENGES</h2>
        <p style="text-align: center; color: var(--text-muted); margin-bottom: 2rem; font-style: italic;">
            Preview of challenges coming to the lab
        </p>
        {difficultyOrder.map((difficulty) => {
            const challenges = challengesByDifficulty[difficulty];
            if (!challenges || challenges.length === 0) return null;
            
            return (
                <div key={difficulty}>
                    <h3 class="difficulty-header" style="margin-top: 2rem; margin-bottom: 1rem; font-size: 1.2rem; color: #00d4ff;">
                        {getDifficultyEmoji(difficulty)} {difficulty.toUpperCase()}
                    </h3>
                    <div class="posts-grid">
                        {challenges.map((challenge) => (
                            <article class="post-card">
                                {challenge.image && (
                                    <img 
                                        src={`${baseUrl}images/${challenge.image}`} 
                                        alt={challenge.name}
                                        style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px 8px 0 0; margin-bottom: 1rem;"
                                    />
                                )}
                                <div class="post-header">
                                    <span class="post-date">DIFFICULTY: {challenge.difficulty.toUpperCase()}</span>
                                    <span class="post-category">{challenge.category.toUpperCase()}</span>
                                </div>
                                <h3 class="post-title">{challenge.name}</h3>
                                <p class="post-excerpt">{challenge.backstory}</p>
                                <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #00d4ff;">
                                    {challenge.points} pts
                                </div>
                            </article>
                        ))}
                    </div>
                </div>
            );
        })}
    </section>


    <section class="contact-section">
        <h2 class="section-title">LAB TOOLS & RESOURCES</h2>
        <div class="contact-content">
            <p class="contact-text">Access specialized tools and frameworks for AI security testing</p>
            <div class="contact-links">
                <a href="#" class="contact-link">
                    <span class="link-icon">[ATTACK TOOLKIT]</span>
                </a>
                <a href="#" class="contact-link">
                    <span class="link-icon">[EXPLOIT DATABASE]</span>
                </a>
                <a href="#" class="contact-link">
                    <span class="link-icon">[WRITEUPS]</span>
                </a>
            </div>
        </div>
    </section>
</BaseLayout>
