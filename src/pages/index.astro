---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
// Filter to only show News and Offensive Security posts (excluding scoping series)
const postsPosts = allPosts.filter((post) => {
  if (post.data.category !== 'News' && post.data.category !== 'Offensive Security') {
    return false;
  }
  // Exclude scoping series posts (they belong in Learning)
  const slug = post.slug.toLowerCase();
  if (slug.includes('scoping') || slug.includes('article-') || slug.includes('scope-series') || 
      slug.includes('model-integration') || slug.includes('multi-turn') || 
      slug.includes('function-calling') || slug.includes('third-party-model') ||
      slug.includes('training-pipeline') || slug.includes('ai-safety-as-security') ||
      slug.includes('continuous-changes') || slug.includes('logging-monitoring') ||
      slug.includes('ai-security-rfps') || slug.includes('ai-incident-response')) {
    return false;
  }
  return true;
});
const recentPosts = postsPosts
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
  .slice(0, 3);

const baseUrl = import.meta.env.BASE_URL.endsWith('/') 
  ? import.meta.env.BASE_URL 
  : `${import.meta.env.BASE_URL}/`;
---

<BaseLayout title="Vortex Node">
    <section id="home" class="hero-section">
        <div class="hero-content">
            <h2 class="hero-title">
                <span class="glitch" data-text="EXPLORING AI">EXPLORING AI</span>
            </h2>
            <p class="hero-subtitle">Offensive Security • Learning • News</p>
            <div class="terminal-window">
                <div class="terminal-header">
                    <span class="terminal-button"></span>
                    <span class="terminal-title">SYSTEM_STATUS</span>
                </div>
                <div class="terminal-body" id="terminal-body">
                    <!-- Terminal content will be added by JavaScript -->
                </div>
            </div>
        </div>
    </section>

    <section id="posts" class="posts-section">
        <h2 class="section-title">RECENT POSTS</h2>
        <div class="posts-grid">
            {recentPosts.map((post) => (
                <article class="post-card">
                    <div class="post-header">
                        <span class="post-date">
                            {new Intl.DateTimeFormat('en-US', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit'
                            }).format(post.data.pubDate)}
                        </span>
                        <span class="post-category">{post.data.category.toUpperCase()}</span>
                    </div>
                    <h3 class="post-title">{post.data.title}</h3>
                    <p class="post-excerpt">{post.data.description}</p>
                    <a href={`${baseUrl}blog/${post.slug}`} class="post-link">READ MORE →</a>
                </article>
            ))}
        </div>
        <div style="text-align: center; margin-top: 40px;">
            <a href={`${baseUrl}blog`} class="post-link" style="font-size: 1.2rem;">VIEW ALL POSTS →</a>
        </div>
    </section>

    <section id="contact" class="contact-section">
        <h2 class="section-title">CONNECT</h2>
        <div class="contact-content">
            <p class="contact-text">Join the network. Share knowledge. Build better AI.</p>
            <div class="contact-links">
                <a href="mailto:contact@vortexnode.net" class="contact-link">
                    <span class="link-icon">[EMAIL]</span>
                </a>
            </div>
        </div>
    </section>
</BaseLayout>
